on:
  workflow_dispatch:

name: Test some script

jobs:
  scala-steward:
    runs-on: ubuntu-22.04
    name: Print some things
    steps:
      - name: Check out my other private repo
        uses: actions/checkout@master
        # with:
        #   repository: thanhz/test-repo-1
        #   token: ${{ secrets.WORKFLOW_PAT }}

      - name: Read repositories from file
        id: read-repos
        run: |
            repos_content=""
            while IFS= read -r line; do
            repo_name=$(echo "$line" | sed -e 's/^- //' -e 's/:scala-steward-dependencies//')
            repos_content+="$repo_name "
            done < repos.md
            echo -e "::set-output name=repos::$repos_content"
        shell: bash

      - name: Print the previous output
        run: |
          # Fetch default branches and latest commits for all repositories in a single request
          repos_info=$(gh api /repos --query "names=${{ steps.read-repos.outputs.repos }}" -q '.[] | {name: .name, default_branch:.default_branch, develop_commit:(.default_branch | @sh) }')
          for repo in $repos_info; do
            echo "Repo: $repo"
          done
        shell: bash
